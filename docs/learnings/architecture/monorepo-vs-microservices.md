# モノレポ vs マイクロサービス

## 意思決定

**採用: モノレポ構成**

## 選定理由

### 開発速度の最大化
- 小規模チームでフロントエンド/バックエンドを同時開発できる
- API契約とUIを同じPRで同時に更新可能
- レビュープロセスが一元化され、コミュニケーションコストが削減

### 柔軟な境界設計
- MVP段階ではドメイン境界が流動的
- モノレポなら責務を柔軟に再配置可能
- リファクタリングのコストが低い

### テスト戦略
- Contract/E2Eテストを同リポで実行
- 破壊的変更をPRで早期検知
- CI/CDが単純化

## 比較評価

### モノレポ vs 分割レポの評価軸

| 評価軸 | モノレポ | マイクロサービス分割 | ChefNextの判断 |
|--------|----------|---------------------|----------------|
| **チームサイズ** | 小規模で有利 | 大規模で有利 | ✅ 小規模 → モノレポ |
| **ドメイン境界** | 流動的で有利 | 明確で有利 | ✅ 流動的 → モノレポ |
| **デプロイ頻度** | 高頻度で有利 | 低頻度で有利 | ✅ 高頻度 → モノレポ |
| **結合度** | 高結合で有利 | 低結合で有利 | ✅ 高結合 → モノレポ |

## 採用したディレクトリ構造

```
ChefNext-1/
├─ apps/
│  ├─ web/          # Vite + React フロントエンド（実装済み）
│  └─ api/          # バックエンド（計画中）
├─ packages/
│  ├─ ui/           # 共通UIコンポーネント（計画中）
│  ├─ api-client/   # API型・hooks（計画中）
│  └─ lint-config/  # 共通設定（計画中）
├─ services/        # 将来の独立サービス（計画中）
│  └─ matching-worker/
├─ infra/
│  ├─ terraform/    # IaC（計画中）
│  └─ docker/       # ローカル開発環境（計画中）
├─ ops/
│  ├─ ci/           # CI/CD設定（計画中）
│  └─ scripts/      # スクリプト（計画中）
└─ docs/
   └─ learnings/    # 学習記録
```

## 将来の移行戦略（計画）

### フェーズ1: モジュール境界の明文化
現在はディレクトリ構造のみ作成。今後、各アプリケーション内でドメインモジュールを明確に分離する。

### フェーズ2: 段階的なサービス分割
独立要件が固まった時点で以下を切り出し検討：
- チャットサービス（リアルタイム性、独立スケール）
- 検索サービス（大量データ、専用インデックス）

### フェーズ3: 独立リポジトリへの移行（必要に応じて）
```bash
# git subtree splitで履歴を保ちながら移行
git subtree split --prefix=services/chat-gateway -b chat-gateway-branch
```

## 学んだこと

### メリット（実感）
1. **構造の明確化**: ディレクトリ構造で責務を視覚的に分離できる
2. **将来の拡張性**: サービス分割の準備ができている

### 今後検証すべきこと
1. **ビルドパフォーマンス**: Turborepo/Nxの導入効果
2. **CI効率**: 変更箇所のみビルドできるか
3. **チーム開発**: 複数人で開発する際のワークフロー

---

**関連ドキュメント**:
- [フロントエンド: Vite + React](../tech-stack/frontend-vite-react.md)

最終更新: 2025-11-27
